(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["6a389924"],{2556:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-layout",{staticClass:"page-visibily-detail"},[a("q-layout-header",[a("q-toolbar",{attrs:{color:"primary"}},[a("q-toolbar-title",[t._v(t._s(t.model.activity_name))]),a("q-btn",{attrs:{flat:""},on:{click:function(e){t.save()}}},[t._v("Save")]),a("q-btn",{attrs:{flat:""},on:{click:function(e){t.cancel()}}},[t._v("Cancel")])],1)],1),a("q-page-container",[a("q-page",[a("v-store-profile",{attrs:{store:t.store}}),a("div",{staticClass:"card-visibility"},[a("q-card",[a("q-card-main",[a("q-field",{attrs:{icon:"important_devices",label:t.labelName,helper:t.labelHelper}},[a("q-input",{model:{value:t.model.data.qty_items,callback:function(e){t.$set(t.model.data,"qty_items",e)},expression:"model.data.qty_items"}})],1)],1)],1),a("v-take-picture",{staticClass:"q-mt-sm",attrs:{images:t.images}})],1)],1)],1)],1)},n=[];i._withStripped=!0;a("ac6a"),a("96cf");var r=a("c973"),s=a.n(r),c=(a("28a5"),a("7514"),a("f490")),o=a("49c2"),u=a("9437"),l=a("ad89"),v=a("3609"),f="statics/no-image.png",m={components:{vStoreProfile:l["a"],vTakePicture:v["a"]},data:function(){return{store:{},images:[{id:1,src:f},{id:2,src:f},{id:3,src:f},{id:4,src:f}],model:{data:{}}}},beforeCreate:function(){var t=this.$q,e=this.$route,a=this.$router,i=e.params,n=i.id,r=i.vid,s=t.localStorage.get.item(n);if(s&&s.visit){var o=s.visit.visibility,u=void 0===o?{}:o,l=this.$store.state.activities;if(!u[r]){var v=l[0].subs.find(function(t){return t.activity_id==r}),f=c["a"].formatDate(new Date,"YYYY-MM-DD");u[r]={day:f,key:"".concat(n,".vis.").concat(r,".").concat(f.split("-")[2]).toLocaleUpperCase(),activity:"visibility",activity_id:v.activity_id,activity_name:v.activity_name,info:JSON.parse(JSON.stringify(v)),data:{store_id:n,start_date:(new Date).toISOString().substr(0,23)}},s.visit.visibility=u}this.$store.commit("store",s),this.$store.commit("visibility",u)}else a.push({name:"app.stores"})},created:function(){var t=this.$route,e=t.params.vid;this.store=this.$store.state.store,this.model=this.$store.state.visibility[e],this.refresh()},computed:{labelName:function(){var t=this.model.activity_name,e=t||"Device";return"".concat(e," Terpasang")},labelHelper:function(){var t=this.model.activity_name,e=t||"Device";return"masukkan jumlah ".concat(e," Terpasang").toLowerCase()}},methods:{refresh:function(){var t=s()(regeneratorRuntime.mark(function t(){var e,a,i,n;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:for(e=this.model,a=0;a<4;a+=1)e.key&&(i="".concat(e.key,".").concat(a+1),n=this.$q.localStorage.get.item(i),n&&(this.images[a].src=n));if(e.data.gps){t.next=8;break}return t.t0=JSON,t.next=6,o["a"].getCurrentPosition();case 6:t.t1=t.sent,e.data.gps=t.t0.stringify.call(t.t0,t.t1);case 8:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),save:function(){var t=s()(regeneratorRuntime.mark(function t(){var e,a,i,n;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(this.validate()){t.next=2;break}return t.abrupt("return");case 2:return e=this.$q,a=this.$store,i=this.$router,n=this.model,t.prev=3,e.loading.show(),t.next=7,u["a"].save(a,n);case 7:e.loading.hide(),i.go(-1),t.next=15;break;case 11:t.prev=11,t.t0=t["catch"](3),e.loading.hide(),e.notify(t.t0.message);case 15:case"end":return t.stop()}},t,this,[[3,11]])}));return function(){return t.apply(this,arguments)}}(),validate:function(){var t=this,e=(this.store,this.model),a=[];try{if(e.data.qty_items=parseInt(e.data.qty_items),e.data.qty_items<0)return this.$q.notify("Silahkan masukkan jumlah terpasang yang benar"),!1}catch(t){return void this.$q.notify(t.message)}return e.data.qty_items?(this.images.forEach(function(i){var n=i.id,r=i.src,s=r.length>100,c=r.indexOf("fieldforce.seegolabs.com/api/buckets")>0,o="".concat(e.key,".").concat(n);s||c?(a.push(r),r.length>100?t.$q.localStorage.set(o,r):t.$q.localStorage.remove(o)):t.$q.localStorage.remove(o)}),0!==a.length||(this.$q.notify("Silahkan masukkan minimal 1 foto"),!1)):(this.$q.notify("Silahkan masukkan jumlah terpasang"),!1)},cancel:function(){this.$router.go(-1)}}},p=m,d=(a("5ab7"),a("2877")),h=Object(d["a"])(p,i,n,!1,null,null,null);h.options.__file="visibilityvisit.vue";e["default"]=h.exports},"5ab7":function(t,e,a){"use strict";var i=a("b0f2"),n=a.n(i);n.a},9437:function(t,e,a){"use strict";a("96cf");var i=a("c973"),n=a.n(i),r=(a("551c"),a("f9d8")),s=a("f1c2"),c=a("f61f"),o=c["a"].init(),u=o.axios,l={saveImages:function(t,e,a){return new Promise(function(){var i=n()(regeneratorRuntime.mark(function i(n,r){var s,c,o,l,v;return regeneratorRuntime.wrap(function(i){while(1)switch(i.prev=i.next){case 0:i.prev=0,s="".concat(Date.now(),".").concat(t,".").concat(a.activity_id),c="visibility",o=1;case 4:if(!(o<=e.length)){i.next=15;break}if(a["pic_".concat(o)]){i.next=12;break}if(l=e[o-1],!(l.length>100)){i.next=12;break}return i.next=10,u.post("buckets",{data:l,folder:c,name:"".concat(s,".").concat(o)});case 10:v=i.sent,a["pic_".concat(o)]="read/".concat(v.data.id);case 12:o+=1,i.next=4;break;case 15:n(s),i.next=21;break;case 18:i.prev=18,i.t0=i["catch"](0),r(i.t0);case 21:case"end":return i.stop()}},i,this,[[0,18]])}));return function(t,e){return i.apply(this,arguments)}}())},saveImagesLocal:function(t,e,a){return new Promise(function(){var i=n()(regeneratorRuntime.mark(function i(n,r){var s,c,o;return regeneratorRuntime.wrap(function(i){while(1)switch(i.prev=i.next){case 0:try{for(s="".concat(t,".").concat(a.activity_id),c=1;c<=e.length;c+=1)a["pic_".concat(c)]||(o=e[c-1],o.length>100&&console.log(s,c));n(s)}catch(t){r(t)}case 1:case"end":return i.stop()}},i,this)}));return function(t,e){return i.apply(this,arguments)}}())},insert:function(t){return new Promise(function(){var e=n()(regeneratorRuntime.mark(function e(a,i){var n,r,s;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,!navigator.onLine){e.next=10;break}return n="visibilities",r={start_date:t.start_date,qty_items:t.qty_items,activity_id:t.activity_id,store_id:t.store_id,gps:t.gps,isonline:t.isonline},e.next=6,u.post(n,r);case 6:s=e.sent,a({images:images,resp:s}),e.next=11;break;case 10:a("offline");case 11:e.next=16;break;case 13:e.prev=13,e.t0=e["catch"](0),i(e.t0);case 16:case"end":return e.stop()}},e,this,[[0,13]])}));return function(t,a){return e.apply(this,arguments)}}())},save_old:function(t,e,a){return new Promise(function(){var i=n()(regeneratorRuntime.mark(function i(n,s){var c;return regeneratorRuntime.wrap(function(i){while(1)switch(i.prev=i.next){case 0:if(i.prev=0,c=e.model,!navigator.onLine){i.next=10;break}return i.next=5,l.saveImages(t.store_id,a,c);case 5:return i.next=7,u.post("visibilities",c);case 7:n("online"),i.next=13;break;case 10:return i.next=12,l.saveImagesLocal(t.store_id,a,c);case 12:n("offline");case 13:r["a"].set(t.store_id,t),i.next=19;break;case 16:i.prev=16,i.t0=i["catch"](0),s(i.t0);case 19:case"end":return i.stop()}},i,this,[[0,16]])}));return function(t,e){return i.apply(this,arguments)}}())},save:function(t,e){var a=t.state.store;return t.commit("visibility",e),r["a"].set(a.store_id,a),new Promise(function(){var a=n()(regeneratorRuntime.mark(function a(i,n){return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:try{e.data.isonline=navigator.onLine?1:0,s["a"].saveDraft(t,e),i(e)}catch(a){s["a"].saveDraft(t,e),n(a)}case 1:case"end":return a.stop()}},a,this)}));return function(t,e){return a.apply(this,arguments)}}())}};e["a"]=l},b0f2:function(t,e,a){}}]);