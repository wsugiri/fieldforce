(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["7d4c9611"],{"0921":function(t,e,i){"use strict";var n=i("d1fc"),r=i.n(n);r.a},"808b":function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("q-layout",{staticClass:"page-visibily-detail"},[i("q-layout-header",[i("q-toolbar",{attrs:{color:"primary"}},[i("q-toolbar-title",[t._v(t._s(t.visibility.activity_name))]),i("q-btn",{attrs:{flat:""},on:{click:function(e){t.save()}}},[t._v("Save")]),i("q-btn",{attrs:{flat:""},on:{click:function(e){t.cancel()}}},[t._v("Cancel")])],1)],1),i("q-page-container",[i("q-page",[i("v-store-profile",{attrs:{store:t.store}}),i("div",{staticClass:"card-visibility"},[i("q-card",[i("q-card-main",[i("q-field",{attrs:{icon:"important_devices",label:t.labelName,helper:t.labelHelper}},[i("q-input",{model:{value:t.model.qty_items,callback:function(e){t.$set(t.model,"qty_items",e)},expression:"model.qty_items"}})],1)],1)],1),i("v-take-picture",{staticClass:"q-mt-sm",attrs:{images:t.images}})],1)],1)],1)],1)},r=[];n._withStripped=!0;i("ac6a"),i("96cf");var a=i("c973"),s=i.n(a),c=(i("7514"),i("9437")),o=i("af13"),u=i("f61f"),v=i("ad89"),l=i("3609"),f={images:{1:"http://dkm.boogr-sooka.club/img/samples/CR-001.jpg",2:"http://dkm.boogr-sooka.club/img/samples/CR-002.jpg",3:"http://dkm.boogr-sooka.club/img/samples/CR-003.jpg",4:"http://dkm.boogr-sooka.club/img/samples/CR-004.jpg"}},p={components:{vStoreProfile:v["a"],vTakePicture:l["a"]},data:function(){return{store:{},activity:{},images:[{id:1,src:f.images[1]},{id:2,src:f.images[2]},{id:3,src:f.images[3]},{id:4,src:f.images[4]}],model:{qty_items:1}}},created:function(){this.refresh()},computed:{visibility:function(){var t=this.$route.params.vid;return this.activity.subs?this.activity.subs.find(function(e){return e.activity_id==t}):{}},labelName:function(){var t=this.visibility.activity_name,e=t||"Device";return"".concat(e," Terpasang")},labelHelper:function(){var t=this.visibility.activity_name,e=t||"Device";return"masukkan jumlah ".concat(e," Terpasang").toLowerCase()}},methods:{refresh:function(){var t=s()(regeneratorRuntime.mark(function t(){var e,i,n,r,a,s;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.$q.loading.show(),e=this.$route,i=e.params,n=i.id,i.vid,t.next=5,o["a"].findOne(n,1);case 5:r=t.sent,a=r.store,s=r.activity,this.store=a,this.activity=s,this.handleData(a),this.$q.loading.hide();case 12:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),handleData:function(t){var e=this.visibility,i=t.activities;if(i){var n=i.find(function(t){return t.activity_id==e.activity_id});if(n&&n.model){var r=n.model;this.model=r;for(var a=0;a<4;a+=1){var s=r["pic_".concat(a+1)];if(s){var c=u["a"].resolveImage(s);this.images[a].src=c}}}}},save:function(){var t=s()(regeneratorRuntime.mark(function t(){var e,i,n,r,a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(e=[],this.images.forEach(function(t){var i=t.src;(i.length>100||i.indexOf("fieldforce.seegolabs.com/api/buckets")>0)&&e.push(i)}),0!==e.length){t.next=5;break}return this.$q.notify("Silahkan masukkan minimal 1 foto"),t.abrupt("return");case 5:if(i=this.store,this.activity,n=this.visibility,i.activities||(i.activities=[]),r=i.activities.find(function(t){return t.activity_id==n.activity_id}),r)for(a in n)r[a]=n[a];else i.activities.push(n);return n.model||(n.model={start_date:(new Date).toISOString().substr(0,23),activity_id:n.activity_id,store_id:i.store_id,gps:i.visit.visit_gps,isonline:navigator.onLine?1:0}),n.model.qty_items=parseInt(this.model.qty_items),this.$q.loading.show(),t.prev=12,t.next=15,c["a"].save(i,n,e);case 15:this.$q.loading.hide(),this.$router.go(-1),t.next=23;break;case 19:t.prev=19,t.t0=t["catch"](12),this.$q.loading.hide(),this.$q.notify(t.t0.message);case 23:case"end":return t.stop()}},t,this,[[12,19]])}));return function(){return t.apply(this,arguments)}}(),cancel:function(){this.$router.go(-1)}}},m=p,d=(i("0921"),i("2877")),h=Object(d["a"])(m,n,r,!1,null,null,null);h.options.__file="visibility_detail.vue";e["default"]=h.exports},9437:function(t,e,i){"use strict";i("96cf");var n=i("c973"),r=i.n(n),a=(i("551c"),i("f9d8")),s=i("f1c2"),c=i("f61f"),o=c["a"].init(),u=o.axios,v={saveImages:function(t,e,i){return new Promise(function(){var n=r()(regeneratorRuntime.mark(function n(r,a){var s,c,o,v,l;return regeneratorRuntime.wrap(function(n){while(1)switch(n.prev=n.next){case 0:n.prev=0,s="".concat(Date.now(),".").concat(t,".").concat(i.activity_id),c="visibility",o=1;case 4:if(!(o<=e.length)){n.next=15;break}if(i["pic_".concat(o)]){n.next=12;break}if(v=e[o-1],!(v.length>100)){n.next=12;break}return n.next=10,u.post("buckets",{data:v,folder:c,name:"".concat(s,".").concat(o)});case 10:l=n.sent,i["pic_".concat(o)]="read/".concat(l.data.id);case 12:o+=1,n.next=4;break;case 15:r(s),n.next=21;break;case 18:n.prev=18,n.t0=n["catch"](0),a(n.t0);case 21:case"end":return n.stop()}},n,this,[[0,18]])}));return function(t,e){return n.apply(this,arguments)}}())},saveImagesLocal:function(t,e,i){return new Promise(function(){var n=r()(regeneratorRuntime.mark(function n(r,a){var s,c,o;return regeneratorRuntime.wrap(function(n){while(1)switch(n.prev=n.next){case 0:try{for(s="".concat(t,".").concat(i.activity_id),c=1;c<=e.length;c+=1)i["pic_".concat(c)]||(o=e[c-1],o.length>100&&console.log(s,c));r(s)}catch(t){a(t)}case 1:case"end":return n.stop()}},n,this)}));return function(t,e){return n.apply(this,arguments)}}())},insert:function(t){return new Promise(function(){var e=r()(regeneratorRuntime.mark(function e(i,n){var r,a,s;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,!navigator.onLine){e.next=10;break}return r="visibilities",a={start_date:t.start_date,qty_items:t.qty_items,activity_id:t.activity_id,store_id:t.store_id,gps:t.gps,isonline:t.isonline},e.next=6,u.post(r,a);case 6:s=e.sent,i({images:images,resp:s}),e.next=11;break;case 10:i("offline");case 11:e.next=16;break;case 13:e.prev=13,e.t0=e["catch"](0),n(e.t0);case 16:case"end":return e.stop()}},e,this,[[0,13]])}));return function(t,i){return e.apply(this,arguments)}}())},save_old:function(t,e,i){return new Promise(function(){var n=r()(regeneratorRuntime.mark(function n(r,s){var c;return regeneratorRuntime.wrap(function(n){while(1)switch(n.prev=n.next){case 0:if(n.prev=0,c=e.model,!navigator.onLine){n.next=10;break}return n.next=5,v.saveImages(t.store_id,i,c);case 5:return n.next=7,u.post("visibilities",c);case 7:r("online"),n.next=13;break;case 10:return n.next=12,v.saveImagesLocal(t.store_id,i,c);case 12:r("offline");case 13:a["a"].set(t.store_id,t),n.next=19;break;case 16:n.prev=16,n.t0=n["catch"](0),s(n.t0);case 19:case"end":return n.stop()}},n,this,[[0,16]])}));return function(t,e){return n.apply(this,arguments)}}())},save:function(t,e){var i=t.state.store;return t.commit("visibility",e),a["a"].set(i.store_id,i),new Promise(function(){var i=r()(regeneratorRuntime.mark(function i(n,r){return regeneratorRuntime.wrap(function(i){while(1)switch(i.prev=i.next){case 0:try{e.data.isonline=navigator.onLine?1:0,s["a"].saveDraft(t,e),n(e)}catch(i){s["a"].saveDraft(t,e),r(i)}case 1:case"end":return i.stop()}},i,this)}));return function(t,e){return i.apply(this,arguments)}}())}};e["a"]=v},af13:function(t,e,i){"use strict";i("7514"),i("ac6a"),i("96cf");var n=i("c973"),r=i.n(n),a=(i("551c"),i("f9d8")),s=i("f61f"),c=s["a"].init(),o=c.axios,u="data-activity",v={list:function(){return a["a"].get.item(u)}},l={list:function(){return new Promise(function(){var t=r()(regeneratorRuntime.mark(function t(e,i){var n,r,s;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,n=v.list(),!navigator.onLine){t.next=10;break}return r="activities?activity_isactive=1&sortBy=sequence&fields=activity_id,activity_name,activity_parent,sequence",t.next=6,o.get(r);case 6:s=t.sent,n=s.data.list.filter(function(t){return""===(t.activity_parent||"")}),n.forEach(function(t){t.subs=s.data.list.filter(function(e){return e.activity_parent===t.activity_id})}),a["a"].set(u,n);case 10:e(v.list()),t.next=16;break;case 13:t.prev=13,t.t0=t["catch"](0),i(t.t0);case 16:case"end":return t.stop()}},t,this,[[0,13]])}));return function(e,i){return t.apply(this,arguments)}}())},findOne:function(t,e){return new Promise(function(){var i=r()(regeneratorRuntime.mark(function i(n,r){var s,c,u,l;return regeneratorRuntime.wrap(function(i){while(1)switch(i.prev=i.next){case 0:if(i.prev=0,s=a["a"].get.item(t),c=v.list().find(function(t){return t.activity_id===e}),!navigator.onLine){i.next=9;break}return u="visibilities/list?store_id=".concat(t),i.next=7,o.get(u);case 7:l=i.sent,s.activities=l.data.list;case 9:n({store:s,activity:c}),i.next=15;break;case 12:i.prev=12,i.t0=i["catch"](0),r(i.t0);case 15:case"end":return i.stop()}},i,this,[[0,12]])}));return function(t,e){return i.apply(this,arguments)}}())},lastActivity:function(){return new Promise(function(){var t=r()(regeneratorRuntime.mark(function t(e,i){var n,r;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,n="activityvisit/last_activities",t.next=4,o.get(n);case 4:r=t.sent,e(r),t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](0),i(t.t0);case 11:case"end":return t.stop()}},t,this,[[0,8]])}));return function(e,i){return t.apply(this,arguments)}}())},detail:function(t,e){return new Promise(function(){var i=r()(regeneratorRuntime.mark(function i(n,r){var a,s,c;return regeneratorRuntime.wrap(function(i){while(1)switch(i.prev=i.next){case 0:a="",i.prev=1,i.t0=t,i.next="2"===i.t0?5:"3"===i.t0?7:9;break;case 5:return a="trainings/".concat(e),i.abrupt("break",11);case 7:return a="escalations/".concat(e),i.abrupt("break",11);case 9:return a="visibilities/".concat(e),i.abrupt("break",11);case 11:return i.next=13,o.get(a);case 13:s=i.sent,c=s.data,n(c),i.next=21;break;case 18:i.prev=18,i.t1=i["catch"](1),r(i.t1);case 21:case"end":return i.stop()}},i,this,[[1,18]])}));return function(t,e){return i.apply(this,arguments)}}())}};e["a"]=l},d1fc:function(t,e,i){}}]);